<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√éK AI Professional</title>
    <style>
        :root { --bg: #0d0d0d; --sidebar: #000; --primary: #10a37f; --user-msg: #2f2f2f; --text: #ececf1; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: sans-serif; display: flex; height: 100vh; overflow: hidden; }
        #sidebar { width: 260px; background: var(--sidebar); border-right: 1px solid #222; display: flex; flex-direction: column; padding: 15px; }
        #main { flex: 1; display: flex; flex-direction: column; position: relative; }
        header { padding: 15px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; max-width: 800px; margin: 0 auto; width: 100%; }
        .ai-label { color: var(--primary); font-weight: bold; margin-bottom: 5px; }
        .user { align-self: flex-end; background: var(--user-msg); padding: 12px; border-radius: 20px; max-width: 80%; }
        .generated-img { width: 100%; max-width: 300px; border-radius: 15px; margin-top: 10px; border: 1px solid var(--primary); background: #222; }

        /* PLUS MENU STYLE */
        #plus-menu { 
            position: absolute; bottom: 80px; left: 20px; background: #212121; 
            border: 1px solid #444; border-radius: 20px; padding: 15px; display: none; 
            flex-direction: column; gap: 5px; width: 220px; box-shadow: 0 -5px 25px rgba(0,0,0,0.6); z-index: 100;
        }
        .menu-item { display: flex; align-items: center; gap: 12px; padding: 12px; cursor: pointer; border-radius: 10px; transition: 0.2s; }
        .menu-item:hover { background: #333; }

        #bottom-bar { padding: 20px; background: linear-gradient(transparent, var(--bg)); }
        #input-wrapper { background: #212121; border-radius: 30px; display: flex; padding: 10px 18px; align-items: center; gap: 12px; border: 1px solid #333; }
        #msg { flex: 1; background: transparent; border: none; color: white; outline: none; font-size: 16px; }
        .btn { background: none; border: none; color: #8e8e93; font-size: 22px; cursor: pointer; }
        .send-btn { color: var(--primary); }
    </style>
</head>
<body>

<input type="file" id="fileInput" style="display:none" onchange="handleFile(this)">
<input type="file" id="cameraInput" style="display:none" accept="image/*" capture="environment" onchange="handleFile(this)">

<div id="sidebar">
    <div style="color: var(--primary); font-weight: bold; font-size: 20px; margin-bottom: 20px;">M√éK AI</div>
    <div style="font-size: 12px; opacity: 0.5;">Founder: Mohammad Israr</div>
</div>

<div id="main">
    <header>
        <div style="font-weight: bold;">M√éK AI Professional</div>
        <div style="color: var(--primary); font-size: 12px; display: flex; align-items: center; gap: 5px;">
            <div style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%;"></div> Online
        </div>
    </header>

    <div id="chat"></div>

    <div id="plus-menu">
        <div class="menu-item" onclick="document.getElementById('cameraInput').click()">üì∏ Camera</div>
        <div class="menu-item" onclick="document.getElementById('fileInput').click()">üñºÔ∏è Photos & Videos</div>
        <div class="menu-item" onclick="document.getElementById('fileInput').click()">üìÇ Document / PDF</div>
    </div>

    <div id="bottom-bar">
        <div id="input-wrapper">
            <button class="btn" onclick="toggleMenu()">‚äï</button>
            <input type="text" id="msg" placeholder="Ask M√éK AI or 'Create a DP of...' ">
            <button class="btn send-btn" onclick="send()">‚ñ≤</button>
        </div>
    </div>
</div>

<script>
    const chat = document.getElementById("chat");
    const msgInput = document.getElementById("msg");
    const plusMenu = document.getElementById("plus-menu");

    function toggleMenu() {
        plusMenu.style.display = plusMenu.style.display === "flex" ? "none" : "flex";
    }

    // Function to handle uploads
    function handleFile(input) {
        const file = input.files[0];
        if (file) {
            addMsg(`Uploading: ${file.name}...`, "user");
            toggleMenu();
            setTimeout(() => {
                addMsg(`Jani, I have received your file "${file.name}". I am analyzing it now...`, "ai");
            }, 1500);
        }
    }

    function addMsg(text, type, isImage = false) {
        const cont = document.createElement("div");
        cont.style.display = "flex";
        cont.style.flexDirection = "column";
        if(type === "ai") {
            const l = document.createElement("div"); l.className = "ai-label"; l.innerHTML = "ü§ñ M√éK AI";
            cont.appendChild(l);
        }
        const d = document.createElement("div");
        d.className = type;
        
        if(isImage) {
            const img = document.createElement("img");
            img.src = text;
            img.className = "generated-img";
            img.onerror = () => { img.src = "https://via.placeholder.com/300?text=Generating+Image..."; };
            d.appendChild(img);
        } else {
            d.innerText = text;
        }
        
        cont.appendChild(d);
        chat.appendChild(cont);
        chat.scrollTop = chat.scrollHeight;
    }

    async function send() {
        const val = msgInput.value.trim();
        if(!val) return;
        plusMenu.style.display = "none";
        addMsg(val, "user");
        msgInput.value = "";

        try {
            const res = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: val })
            });
            const data = await res.json();
            
            if(data.isImage) {
                addMsg(data.reply, "ai", true);
            } else {
                addMsg(data.reply, "ai");
            }
        } catch (e) {
            addMsg("‚ö†Ô∏è Brain connection error. Check Render logs, Jani!", "ai");
        }
    }
</script>
</body>
</html>
