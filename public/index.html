<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√éK AI Professional</title>
    <style>
        :root { 
            --bg: #0d0d0d; 
            --sidebar: #000000;
            --bubble-ai: #1a1a1a;
            --bubble-user: #2f2f2f;
            --primary: #10a37f; /* ChatGPT Green */
            --text: #ececf1;
        }
        
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'SOHO', sans-serif; display: flex; height: 100vh; }

        /* Sidebar Style */
        #sidebar { width: 260px; background: var(--sidebar); padding: 15px; display: flex; flex-direction: column; gap: 10px; border-right: 1px solid #2d2d2d; }
        .menu-item { padding: 12px; border-radius: 8px; cursor: pointer; transition: 0.3s; font-size: 14px; display: flex; align-items: center; gap: 10px; }
        .menu-item:hover { background: #202123; }
        .active-persona { border: 1px solid var(--primary); color: var(--primary); }

        /* Main Chat Area */
        #main { flex: 1; display: flex; flex-direction: column; position: relative; }
        header { padding: 15px; border-bottom: 1px solid #2d2d2d; display: flex; justify-content: space-between; align-items: center; }
        
        #chat { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 24px; }
        
        /* ChatGPT Bubble Style */
        .msg-wrapper { display: flex; flex-direction: column; width: 100%; }
        .msg { max-width: 85%; padding: 10px 15px; font-size: 16px; line-height: 1.6; position: relative; }
        .user { align-self: flex-end; background: var(--bubble-user); border-radius: 20px; color: white; }
        .ai { align-self: flex-start; background: transparent; } /* AI doesn't have a bubble in newest ChatGPT style */

        /* Modern Input Bar */
        #input-container { padding: 20px; background: linear-gradient(transparent, var(--bg)); }
        #input-box { 
            max-width: 800px; margin: auto; background: #212121; border: 1px solid #424242; 
            border-radius: 25px; padding: 10px 15px; display: flex; align-items: center; gap: 10px; 
        }
        #msg { flex: 1; background: transparent; border: none; color: white; outline: none; resize: none; font-size: 16px; height: 24px; }
        .icon-btn { cursor: pointer; opacity: 0.6; transition: 0.3s; font-size: 20px; }
        .icon-btn:hover { opacity: 1; color: var(--primary); }

        @media (max-width: 768px) { #sidebar { display: none; } } /* Hide sidebar on mobile for now */
    </style>
</head>
<body>

    <div id="sidebar">
        <div style="font-weight: bold; margin-bottom: 20px; color: var(--primary);">M√éK Ecosystem</div>
        <div class="menu-item active-persona" onclick="setPersona('Friend')">üí¨ General Chat</div>
        <div class="menu-item" onclick="setPersona('Coding Expert')">üíª Coding Mode</div>
        <div class="menu-item" onclick="setPersona('Religious Scholar')">üåô Islamic Scholar</div>
        <div class="menu-item" onclick="setPersona('News Explorer')">üåê Real-time News</div>
        <div style="margin-top: auto;" class="menu-item">‚öôÔ∏è Settings</div>
    </div>

    <div id="main">
        <header>
            <div id="persona-title">M√éK AI - Friend</div>
            <select id="voiceSelect" style="background:#202123; color:white; border:none; border-radius:5px;"></select>
        </header>

        <div id="chat"></div>

        <div id="input-container">
            <div id="input-box">
                <span class="icon-btn">‚äï</span>
                <textarea id="msg" placeholder="Ask M√éK anything..."></textarea>
                <button id="micBtn" class="icon-btn" onclick="toggleMic()" style="background:none; border:none; color:white;">üéôÔ∏è</button>
                <button class="icon-btn" onclick="send()" style="background:none; border:none; color:var(--primary);">‚ñ≤</button>
            </div>
        </div>
    </div>

    <script>
        const chat = document.getElementById("chat");
        const msgInput = document.getElementById("msg");
        let currentPersona = "Friend";

        function setPersona(p) {
            currentPersona = p;
            document.getElementById("persona-title").innerText = "M√éK AI - " + p;
            addMsg(`Mode changed to: ${p}. How can I assist you now?`, "ai");
        }

        function addMsg(text, type) {
            const wrapper = document.createElement("div");
            wrapper.className = "msg-wrapper";
            const div = document.createElement("div");
            div.className = "msg " + type;
            div.innerText = text;
            wrapper.appendChild(div);
            chat.appendChild(wrapper);
            chat.scrollTop = chat.scrollHeight;
            if (type === "ai") speak(text);
        }

        async function send() {
            const text = msgInput.value.trim();
            if (!text) return;
            addMsg(text, "user");
            msgInput.value = "";

            try {
                const res = await fetch("/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        message: text, 
                        persona: currentPersona // Tell backend who to be!
                    })
                });
                const data = await res.json();
                addMsg(data.reply, "ai");
            } catch (e) {
                addMsg("‚ö†Ô∏è Connection error.", "ai");
            }
        }

        // Voice & Mic logic remains the same from our previous steps...
        let synth = window.speechSynthesis;
        function speak(t) { if(!synth.speaking){ const u = new SpeechSynthesisUtterance(t); synth.speak(u); } }
        // (SpeechRecognition code here...)
    </script>
</body>
</html>
