<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√éK AI Professional</title>
    <style>
        :root { 
            --primary: #00ff99; 
            --bg: #0a0a0b; /* Slightly lighter black for depth */
            --ai-bubble: #1e1e20; 
            --user-bubble: #00ff99;
            --text-main: #ffffff;
        }
        
        body { margin: 0; background: var(--bg); color: var(--text-main); font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        header { padding: 15px 20px; background: #161618; border-bottom: 1px solid #282828; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.5); }
        header h1 { margin: 0; color: var(--primary); font-size: 20px; font-weight: 800; letter-spacing: 1px; }
        .voice-settings { background: #252527; color: white; border: 1px solid #444; padding: 6px; border-radius: 8px; font-size: 12px; cursor: pointer; }

        #chat { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; background-image: radial-gradient(#1a1a1c 1px, transparent 1px); background-size: 20px 20px; }
        
        /* CLEAR CHAT BUBBLES */
        .msg { 
            max-width: 80%; 
            padding: 14px 18px; 
            border-radius: 20px; 
            line-height: 1.6; 
            font-size: 16px; 
            font-weight: 500;
            word-wrap: break-word;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: fadeIn 0.3s ease;
        }

        .user { 
            background: var(--user-bubble); 
            color: #000000; /* Deep black text on green for perfect contrast */
            align-self: flex-end; 
            border-bottom-right-radius: 4px;
        }

        .ai { 
            background: var(--ai-bubble); 
            color: #f0f0f0; 
            align-self: flex-start; 
            border-bottom-left-radius: 4px;
            border: 1px solid #333;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* INPUT AREA */
        #input-box { padding: 15px; background: #161618; display: flex; gap: 12px; border-top: 1px solid #282828; align-items: center; }
        textarea { 
            flex: 1; 
            background: #252527; 
            border: 1px solid #444; 
            border-radius: 25px; 
            padding: 12px 20px; 
            color: white; 
            outline: none; 
            resize: none; 
            font-size: 15px; 
            height: 48px;
            transition: 0.3s;
        }
        textarea:focus { border-color: var(--primary); background: #2a2a2c; }

        .btn { width: 48px; height: 48px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 22px; transition: 0.2s; }
        .btn-mic { background: #2d2d30; color: white; border: 1px solid #444; }
        .btn-mic.active { background: #ff4444; border-color: #ff4444; box-shadow: 0 0 15px rgba(255,68,68,0.5); }
        .btn-send { background: var(--primary); color: black; box-shadow: 0 4px 10px rgba(0, 255, 153, 0.3); }
        .btn:active { transform: scale(0.9); }
    </style>
</head>
<body>
    <header>
        <h1>M√éK AI</h1>
        <select id="voiceSelect" class="voice-settings"><option value="">Loading Voices...</option></select>
    </header>

    <div id="chat"></div>

    <div id="input-box">
        <button id="micBtn" class="btn btn-mic" onclick="toggleMic()">üéôÔ∏è</button>
        <textarea id="msg" placeholder="Message M√éK AI..."></textarea>
        <button class="btn btn-send" onclick="send()">üöÄ</button>
    </div>

    <script>
        const chat = document.getElementById("chat");
        const msgInput = document.getElementById("msg");
        const voiceSelect = document.getElementById("voiceSelect");
        const micBtn = document.getElementById("micBtn");
        let synth = window.speechSynthesis;
        let voices = [];

        function loadVoices() {
            voices = synth.getVoices();
            voiceSelect.innerHTML = '';
            voices.forEach((voice, i) => {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = voice.name;
                if (voice.name.includes('Female')) option.selected = true;
                voiceSelect.appendChild(option);
            });
        }
        if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = loadVoices;

        function speak(text) {
            if (synth.speaking) synth.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            utter.voice = voices[voiceSelect.value];
            synth.speak(utter);
        }

        window.onload = () => {
            setTimeout(() => {
                let name = localStorage.getItem("mik_name") || prompt("Assalamu Alaikum! What is your name?");
                if (name) localStorage.setItem("mik_name", name);
                addMsg(`Assalamu Alaikum ${name || 'Jani'}! I am M√éK AI. Ready for your command!`, "ai");
            }, 800);
        };

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.onstart = () => micBtn.classList.add('active');
            recognition.onend = () => micBtn.classList.remove('active');
            recognition.onresult = (e) => { msgInput.value = e.results[0][0].transcript; send(); };
        }
        function toggleMic() { recognition && (micBtn.classList.contains('active') ? recognition.stop() : recognition.start()); }

        function addMsg(text, type) {
            const div = document.createElement("div");
            div.className = "msg " + type;
            div.innerText = text;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
            if (type === "ai" && text !== "Thinking...") speak(text);
        }

        async function send() {
            const text = msgInput.value.trim();
            if (!text) return;
            addMsg(text, "user");
            msgInput.value = "";
            const load = document.createElement("div");
            load.className = "msg ai"; load.innerText = "Thinking...";
            chat.appendChild(load);
            try {
                const res = await fetch("/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: text })
                });
                const data = await res.json();
                chat.removeChild(load);
                addMsg(data.reply, "ai");
            } catch (e) { load.innerText = "‚ö†Ô∏è Server busy. Try again!"; }
        }
        setTimeout(loadVoices, 500);
    </script>
</body>
</html>
